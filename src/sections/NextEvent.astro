---
import dayjs from 'dayjs';

const fetchEvents = async () => {
  try {
    const response = await fetch('https://api.micheleberardi.com/racing/v1.0/motogp-events?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9&year=2024');
    if (!response.ok) {
      throw new Error(`Network response was not ok: ${response.statusText}`);
    }
    const data = await response.json();
    return data;
  } catch (error) {
    console.error('Error fetching events:', error);
    return [];
  }
};

const events = await fetchEvents();
const now = new Date();
const closestEvent = events.reduce((closest : any, current : any) => {
    const currentStartDate  = new Date(current.date_start);
    if (!closest || (currentStartDate < new Date(closest.date_start) && currentStartDate > now)) {
    return current;
  }
    return closest;
}, null)
console.log(closestEvent);
var isSameWeek = dayjs().isSame(dayjs(closestEvent.date_start),"week")
---
<section class="bg-black p-10">
    <div class="min-h-52 flex flex-col w-full justify-center">
            <h2 class="w-full text-white pb-10 font-semibold text-4xl uppercase text-center">Next event</h2>
            <div class="flex flex-col md:flex-row flex-grow justify-center items-start w-full max-w-screen-xl mx-auto">
                <div class="flex flex-col items-center flex-1 p-4 border-b md:border-b-0 border-gray-500 md:h-full">
                    <h3 class="text-white text-3xl text-center pb-3 font-semibold">{closestEvent.sponsored_name ?? ""}</h3>
                    <p class="text-white text-2xl p-4">{closestEvent.date_start ?? ""} - {closestEvent.date_end ?? ""}</p>
                    <p class="text-4xl text-red-500">{isSameWeek ? "RACE WEEK" : ""}</p>
                </div>
                <div class="flex flex-col items-center md:border-l flex-1 p-4 md:h-full">
                    <p class="text-white text-lg">FP1: </p>
                    <p class="text-white text-lg">FP2: </p>
                    <p class="text-white text-lg">Q1: </p>
                    <p class="text-white text-lg">Q2: </p>
                    <p class="text-white text-lg">Sprint: </p>
                    <p class="text-white text-lg">Race: </p>
                </div>
            </div>
        </div>
    </div>
</section>